<!DOCTYPE HTML>
<html>
  <head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta name="keywords" content="用户管理">
	<meta name="description" content="后台管理系统。">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>用户管理</title>
    <link rel="stylesheet" type="text/css" href="../../easyui/themes/metro/easyui.css" />
	<link rel="stylesheet" type="text/css" href="../../easyui/themes/icon.css" />
	<link rel="stylesheet" type="text/css" href="../../css/common.css" />
	<script type="text/javascript" src="../../js/jquery-1.11.1.js"></script>
	<script type="text/javascript" src="../../easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="../../easyui/locale/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
  </head>
  <script>
  	(function(){
  		debugger
  		var width = $("document").width
  		$("body").css("width","200px");
  	})
  	 //关闭添加页面内容弹出框
	function dialogOrgContentsClose() {
		$('#orgContentsDialog').dialog('close');
	}
	 //关闭添加页面内容弹出框
	function dialogOrgContentsOpen() {
		$('#orgContentsDialog').dialog('open');
	}
	
	 //关闭添加页面内容弹出框
	function addOrgContents() {
		
		
		$('#orgContentsDialog').dialog({
			title:"添加用户"
		});
		$('#orgContentsDialog').dialog('open');
		
	}
	
	//列表查询
	function query(){
		var pagerOptions = $(pager).pagination('options');
		var PAGESIZE = pagerOptions.pageSize;
		var PAGEINDEX = pagerOptions.pageNumber < 1 ? 1 : pagerOptions.pageNumber;

		var searchParam = {

			key: $('#searchUserNameTxt').textbox('getValue'),
			name: $('#searchNameTxt').textbox('getValue'),
			deptId:   $("#searchDeptId").combobox('getValue'),
			currentPage: PAGEINDEX,
			pageSize: PAGESIZE
		}

		var searchParamStr = JSON.stringify(searchParam);
		
		$('#userContentsGrid').datagrid("loading","玩命加载。。。");  

		$.ajax({
			type: "POST",
			url: '/api/user/list',
			async: true,
			data:searchParamStr,
			contentType: 'application/json', // 告诉jQuery不要去设置Content-Type请求头
			success: function(data, textStatus) {
				$('#userContentsGrid').datagrid("loaded");
				var code = data.code;
				var msg = data.description;
				if (code == 0) {
					if (data.result.list === undefined ||data.result.list.length == 0) {
						$('#userContentsGrid').datagrid('loadData', {
							total: 0,
							rows: []
						}); //清空网格数据
						showInfo('查询结果为空');
						return;
					}
					$('#userContentsGrid').datagrid('loadData', {
						"total": data.result.totalCount,
						"rows": data.result.list
					});
				} else {
					showInfo(msg);
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				$('#userContentsGrid').datagrid("loaded");
				showError("访问服务失败");
			}
		});
	}
	
	$(document).ready(function() {
			
			//初始化网格
				$('#userContentsGrid').datagrid({
//					height: ($(document).height() - otherHeight),
//					onLoadSuccess: function(data) {
//						$("#userContentsGrid").datagrid('doCellTip', {
//							'max-width': '300px',
//							'delay': 500
//						});
//					}
					rowStyler: function(index,row){
						if (index%2 != 0){
							return 'background-color:#F2F2F2;'; // return inline style
						}
					}
				});

				//设置分页控件
				pager = $('#userContentsGrid').datagrid('getPager');
				$(pager).pagination({
					onSelectPage: query,
					pageSize: 20,
					pageList: [20, 50, 100, 200],
					beforePageText: '第',
					afterPageText: '页	共{pages}页',
					displayMsg: '当前显示 {from} - {to} 条记录		共 {total} 条记录'
				});
			
		
			$('#moduelPermissionGrid').treegrid({
				url: '/api/module/list', //访问后台的地址 
				method: 'get',
				idField: 'id',
				treeField: 'name',
				checkbox: true,
				loadFilter: function(data) {
					return data.result;
				},
			});
			
			query()
			
//			init()

		get("/api/module/list",{},null,null);
		});
	
  </script>
  
  <body>
	<!-- 标题 -->
		<div class="headerTitle">
			<font>用户管理</font>
			<!--<a href="">模块帮助</a>-->
		</div>

		<!-- 查询条件 -->
		<div class="searchPanel">
			<div class="row">
				<div class="leftCell">
					<font>用户姓名:</font>
				</div>
				<div class="rightCell">
					<input id="searchNameTxt" class="easyui-textbox" type="text" style="width:100%" />
				</div>
				<div class="leftCell">
					<font>部门:</font>
				</div>
				<div class="rightCell">
					<input id="searchDeptId" class="easyui-combotree" type="text" style="width:100%" data-options="prompt:'请选择部门',editable:false,url:'/api/org/select/list',
										method:'get',
										valueField:'id',
										textField:'orgName',
										loadFilter:function(data){
											return data.result
										}" />
				</div>
				<div class="leftCell"><font>状态:</font>
				</div>
				<div class="rightCell">
					<select id="cbStatus" class="easyui-combobox" style="width:100%;" data-options="editable:false">
						<option value="0">有效</option>
						<option value="S">无效</option>
					</select>
				</div>
				<div class="leftCell">
					<font>账户名:</font>
				</div>
				<div class="rightCell">
					<input id="searchUserNameTxt" class="easyui-combobox" type="text" style="width:100%" data-options="editable:false" />
				</div>
			</div>
			<div class="row">
				<div style="width:20%;min-width:120px;height:30px;float:right;text-align:right;margin-right: 27px;">
					<a href="javascript:query()" class="easyui-linkbutton" data-options="iconCls:'icon-oto-search'">查询</a>
					<a href="javascript:cancel()" class="easyui-linkbutton" data-options="iconCls:'icon-oto-reset'">重置</a>
				</div>
				<div style="clear:both"></div>
			</div>
		</div>

		<!-- 网格标题 -->
		<div class="gridTitle">
			<font class="titleNameFont">明细信息</font>
		</div>

		<!-- 网格按钮栏 -->
		<div class="gridBtnBar">
			<a href="javascript:addOrgContents()" class="easyui-linkbutton" iconCls="icon-oto-add" plain="true">新增</a>
			<a href="javascript:updateOrgContent()" class="easyui-linkbutton" iconCls="icon-oto-edit" plain="true">修改</a>
			<a href="javascript:deleteOrgContents()" class="easyui-linkbutton" iconCls="icon-oto-delete" plain="true">删除</a>
		</div>
		<!-- 网格 -->
		<table id="userContentsGrid" class="easyui-datagrid" style="width:100%;height:100%" data-options="singleSelect:true,pagination:true,remoteSort:false">
			<thead>
				<tr>
					<th data-options="field:'ck',checkbox:true"></th>
					<th data-options="field:'userNo',width:'10%',sortable:true">用户工号</th>
					<th data-options="field:'name',width:'8%',sortable:true">用户姓名</th>
					<th data-options="field:'userName',width:'10%',sortable:true">登录帐号</th>
					<th data-options="field:'orgName',width:'15%',sortable:true">所属部门</th>
					<th data-options="field:'roleName',width:'15%',sortable:true">当前岗位</th>
					<th data-options="field:'joinTime',width:'12%',sortable:true">入职时间</th>
					<th data-options="field:'status',width:'7%',sortable:true">状态</th>
				</tr>
			</thead>
		</table>
		
		<!--添加用户内容弹出框-->
		<div id="orgContentsDialog" class="easyui-dialog" closed="true" title: "页面内容" style="width:520px;height:460px; " data-options="buttons: '#dlg-buttons',modal:true ">
			<table style="padding-left:15px;padding-right:15px; padding-top:10px;">
			<tr style="margin-bottom: 10px;">
				<input id="userId" type="hidden" />
				<td align="right"><font color="#FF0000">*</font>用户姓名:</td>
				<td colspan="3" align="left">
					<input class="easyui-textbox" id="name" style="width: 394px;" data-options="editable:true" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000">*</font>用户工号:</td>
				<td align="left" colspan="3">
					<input type="text" class="easyui-textbox" id="userCode" style="width: 394px;" data-options="editable:true" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000">*</font>账户名:</td>
				<td align="left" colspan="3">
					<input type="text" class="easyui-textbox" id="userName" style="width: 394px;" data-options="editable:true" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000">*</font>密码:</td>
				<td align="left" colspan="3">
					<input type="text" class="easyui-textbox" id="password" style="width: 394px;" data-options="editable:true" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000">*</font>再次输入密码:</td>
				<td align="left" colspan="3">
					<input type="text" class="easyui-textbox" id="agianPassword" style="width: 394px;" data-options="editable:true" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<input id="deptId" type="hidden" />
				<td align="right"><font color="#FF0000">*</font>所属部门</td>
				<td align="left" colspan="3">
					<input type="text" class="easyui-combobox" id="deptId" style="width: 394px;" data-options="editable:false" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000">*</font>入职时间:</td>
				<td>
					<input type="text" class="easyui-datebox" id="joinTime" style="width: 172px;" required="required" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000">*</font>岗位分配:</td>
				<td width="320px" align="left" colspan="3">
					<input type="text" class="easyui-combobox" id="txtRoleId" style="width: 394px;" data-options="editable:false" />
				</td>
			</tr>
			<tr style="margin-bottom: 10px;">
				<td align="right"><font color="#FF0000"></font>权限显示:</td>
				<!-- 权限网格 -->
				<td width="320px" align="left" colspan="3">
				<table id="permissionGrid" class="easyui-datagrid" style="width:394px;height:100%" data-options="pagination:false,remoteSort:false">
					<thead>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块(菜单)</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
						<tr>
							<th data-options="field:'userIdx',width:'40%',sortable:true">模块</th>
							<th data-options="field:'userNo',width:'60%',sortable:true">权限</th>
						</tr>
					</thead>
				</table>
				</td>
			</tr>
			</table>
			<div id="dlg-buttons">
				<a href="javascript:submit()" class="easyui-linkbutton" iconCls="icon-oto-save">保存</a>
				<a href="javascript:dialogOrgContentsClose()" class="easyui-linkbutton" iconCls="icon-oto-delete">关闭</a>
			</div>
		</div>
  </body>
</html>
